# Hooks Personnalis√©s : Logique r√©utilisable

### üí° Hooks Personnalis√©s : Logique r√©utilisable

## üìù Tes notes

Detaille ce que tu as appris ici
`src/exercise/02.md`ou¬†sur¬†une¬†page¬†[Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Dans une application il arrive souvent que l'on ai a faire les m√™mes actions
dans diff√©rentes parties. Prenons un exemple courant, les appels API REST.

```jsx
const [data, setData] = React.useState([])

React.useEffect(() => {
  fetch(`https://hn.algolia.com/api/v1/search?query=${query}`)
    .then(response => response.json())
    .then(json => {
      setData(json.hits)
    })
}, [query])
```

On pourrait avoir besoin de faire ces appels dans plusieurs composants. Il
faudrait alors dupliquer cette logique partout ou l'on a besoin de faire ces
appels API. La maintenance devient compliqu√© et ne respecte pas le principe DRY
(Don't Repeat Yourself). Les Hook personnalis√©s permettent d'extraire une
logique particuliere dans un Hook dans le but de pouvoir la r√©utiliser partout.

**Qu'est-ce qu'un Hook personnalis√© ?**

- Une fonction JavaScript
- Avec un nom commen√ßant par "use"
- Qui peut appeler d'autres Hooks
- Avoir ses propres states et props

üìë Le lien vers la doc
[des Hooks personnalis√©s](https://fr.reactjs.org/docs/hooks-custom.html)

## Exercice

Dans cet exercice nous allons reprendre les appels aux API REST de Marvel et
construire nos propres Hooks Personnalis√©s. Commen√ßons par un Hook simple qui
nous permettrais de savoir si un personnage Marvel exist que l'on pourrait
utiliser comme cela.

```jsx
const marvelExist = useMarvelExist(marvelName)
```

## Bonus

### 1. üöÄ Hook avec Personnage / erreur

Tu vas devoir faire √©voluer le hook pour pouvoir charger un personnage ou
indiquer une erreur. Renommons notre Hook comme cela :

```jsx
const [marvel, error] = useFindMarvelByName(marvelName)
```

Supprime le state `exist` et utilise plut√¥t 2 states `marvel, error` que tu
retourneras du hook avec `return [marvel, error]`.

L√®ve une erreur si le state `error` est pr√©sent, il sera catcher par
`ErrorBoundary`.

```jsx
const [marvel, error] = useFindMarvelByName(marvelName)
if (error) {
  throw error
}
```

### 2. üöÄ useReducer

Plut√¥t que d'utiliser deux state, combinons les avec useReducer

```jsx
const reducer = (state, action) => ({...state, ...action})

const [state, dispatch] = React.useReducer(reducer, {
  marvel: null,
  error: null,
})
//... dans useEffect
dispatch({error: null})
dispatch({marvel: null})
// return state √† la fin du hook
```

Comme nous affichons un personnage Marvel, tu peux r√©utiliser le composant
`MarvelPersoView` du module pr√©c√©dent a la place du nom

```jsx
<MarvelPersoView marvel={marvel} />
```

### 3. üöÄ Type d'action et payload

Plus nous allons avoir de donn√©es : `error`, `marvel`, etc ... plus il va
falloir les g√©rer individuellement. On voit d√©j√† avant l'appel API :

```jsx
dispatch({error: null})
dispatch({marvel: null})
```

A la place nous voudrions avoir un action utiliser des types d'action avec des
donn√©es en payload. Par exemple

```jsx
dispatch({type: 'fetching'})
dispatch({type: 'done', payload: marvel})
dispatch({type: 'fail', error})
```

- L'action `fetching` se chargera d'initialiser correctement tous les states
  (`error`, `marvel` √† `null`)
- L'action `done` se chargera d'initialiser les states `error` √† `null` et
  `marvel`
- L'action `fail` se chargera d'initialiser les states
  `error avec le message d'ereur`et `marvel` √† `null`

Dans cet exercice tu vas devoir g√©rer cela dans le `reducer` .

### 4. üöÄ G√©rer le chargement avec un status

On voudrait maintenant g√©rer plus finement avec un statut.

- `idle` : situation de base : afficher entrer un nom de Marvel
- `fetching` : quand l'appel API est en cours : afficher chargement en cours ...
- `fail` : quand une erreur survient : `throw error` sera g√©rer par
  `ErrorBoundary`
- `done` : afficher le personnage Marvel dans
  `<MarvelPersoView marvel={marvel} />`

Tu vas devoir rajouter `status` dans le `useReducer` et le g√©rer dans `reducer`

Dans le composant Marvel pour pourra g√©rer plusieurs rendu en fonction du status

```jsx
if (status === 'fail') {
  throw error
} else if (status === 'idle') {
  return 'enter un nom de Marvel'
} else if (status === 'fetching') {
  return 'chargement en cours ...'
} else if (status === 'done') {
  return <MarvelPersoView marvel={marvel} />
}
```

### 5. üöÄ Fetch g√©n√©rique

On voudrait pouvoir r√©utiliser cette logique mais peu importe le type de donn√©es
r√©cup√©r√©es via des API. Nous allons rendre le hook le plus g√©n√©rique possible.
Renommer `useFindMarvelByName` en `useFetchData` et en ajoutant un param√®tre
`fetch` qui contiendra la fonction de fetch (`fetchMarvel` ou `fetchMarvelList`
ou autre). On renommera le state `marvel` en `data` dans le `reducer`

```jsx
function useFetchData(search, fetch) {
  //...
  fetch(search)
  //...
}
```

Par composition il est maintenant possible d'avoir le m√™me hook que pr√©c√©demment
.

```jsx
function useFindMarvelByName(marvelName) {
  return useFetchData(marvelName, fetchMarvel)
}
const state = useFindMarvelByName(marvelName, fetchMarvelById)
```

Dans cet exercice il va falloir cr√©er un hook `useFindMarvelList` qui utilise la
fonction `fetchMarvelsList` (√† importer depuis `marvel.js`) et la passe en
param√®tre de `useFetchData`. Ce hook sera appel√© depuis un nouveau composant
`MarvelList`. Ajouter une `checkBox` avec un state `searchList` et conditionner
l'affichage.

```jsx
<ErrorBoundary key={marvelName} FallbackComponent={ErrorDisplay}>
  {searchList ? (
    <MarvelList marvelName={marvelName} />
  ) : (
    <Marvel marvelName={marvelName} />
  )}
</ErrorBoundary>
```

Le `render` de `MarvelList` sera comme ceci

```jsx
{
  data.map(marvel => {
    return (
      <>
        <hr style={{background: 'grey'}} />
        <MarvelPersoView marvel={marvel} />
      </>
    )
  })
}
```

## üêú Feedback

Remplir le formulaire le
[formulaire de FeedBack.](https://go.mikecodeur.com/cours-react-avis?entry.1430994900=React%20Hooks%20Avanc√©s&entry.533578441=02%20Hooks%20Personnalis√©s%20:%20Logique%20r√©utilisable)
